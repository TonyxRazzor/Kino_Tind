<!-- admin/load_data_view.html -->
{% extends 'admin/base_site.html' %}

{% block content %}
    <h2>Загрузка данных</h2>
    <form id="load-data-form" method="post" action="{% url 'films:load_data_action' %}">
        {% csrf_token %}
        <button type="submit" class="button">Загрузить данные в базу</button>
    </form>

    <progress id="progress-bar" value="0" max="100" style="display: none;"></progress>

    <div id="messages-container"></div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('load-data-form').addEventListener('submit', function(event) {
        var progressBar = document.getElementById('progress-bar');
        progressBar.style.display = 'block';
        progressBar.value = 0;

        var xhr = new XMLHttpRequest();
        xhr.open('POST', this.action, true);

        xhr.upload.onprogress = function(e) {
            if (e.lengthComputable) {
                progressBar.value = (e.loaded / e.total) * 100;
            }
        };

        xhr.onload = function() {
            progressBar.style.display = 'none';
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                var messageContainer = document.getElementById('messages-container');
                messageContainer.innerHTML = '<ul class="messages"><li class="' + (response.success ? 'success' : 'error') + '">' + response.message + '</li></ul>';
            }
        };

        var formData = new FormData(this);
        xhr.send(formData);

        event.preventDefault();
    });
</script>
{% endblock %}
